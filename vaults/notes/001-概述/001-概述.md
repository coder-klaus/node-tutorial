## 定义

数据库管理系统（DBMS）是一种运行在服务器上的软件，用于高效地存储、管理和检索数据

+ 运行在服务器上的软件一般没有UI
+ 通过它提供的 API 来存取数据。
+ 数据库通过特定的算法高效地存储和读取数据

数据库就像一个大仓库，把数据有条理地存起来，方便程序随时调用



### 为什么不直接存文件

1. 无法表示数据和数据之间的联系 「 SQL通过主外键进行标识 」
2. 存取和读取效率低，更新效率慢
3. 不利于数据共享，无法保证操作的原子性 「 数据在被一个程序修改时，就不要让其它程序在进行操作了 」
   + 多个程序同时操作数据很难进行协调
4. 备份、迁移、恢复等操作很麻烦



## 分类

数据库可以分为 **关系型数据库** 和 **非关系型数据库**



### 关系型数据库

关系型数据库 => `MySQL`、`PostgreSQL`、`Oracle`

+ 以`B+树`的形式存储数据，显示为表结构
+ 有主键和外键，通过外键可以抽取多条记录中的重复数据，避免数据冗余
+ 操作的方式就是SQL 「  结构化查询语句 」

> 不同SQL数据库之间核心思想一致，但语法存在细微差异
>
> => 本例以`MySQL`为主要示例



对于关系型数据库而言

1. 一个数据库软件中可以存在多个数据库
2. 一个数据库中可以存在多个数据表
   + 表和表之间通过外键（foreign key）建立关系，比如一对一、一对多、多对多等
3. 一个数据表中可以存在多条记录
4. 每条记录由多个字段一起组成



### 非关系型数据库

非关系型数据库 => `MongoDB`、`Redis`

+ NoSQL 「 not only sql 」=> 不仅仅是SQL

+ 不同NoSQL 存储方式不一样，操作方式也不一样

  + `MongoDB`

    + 用集合（collection）来管理和组织数据文档。
  
    + 操作方式是通过一系列的函数
  
    +  BSON（一种类似 JSON 的二进制格式）进行数据存储
  
  
    ```js
    import { MongoClient } from 'mongodb';
    
    const url = 'mongodb://localhost:27017';
    const client = new MongoClient(url);
    
    await client.connect();
    const db = client.db('test');
    const users = db.collection('users');
    
    // 插入
    await users.insertOne({ name: "Alice", age: 25, city: "Shanghai" });
    ```
  
  + `Redis` 
  
    + 用“键（key）”来管理和组织数据。
      + Redis 是一个基于键值对（key-value）的内存数据库，所有数据都通过唯一的键来访问和管理
    + 操作方式是通过一系列的命令。
      + Redis 提供丰富的命令（如 `SET`、`GET`、`HSET`、`LPUSH` 等）来操作不同类型的数据结构。
    + 以多种数据结构（如字符串、哈希、列表、集合、有序集合等）在内存中进行数据存储。
      + Redis 支持多种高效的数据结构，所有数据默认存储在内存中，支持持久化到磁盘。
  
    ```js
    import { createClient } from 'redis';
    
    const client = createClient();
    
    client.on('error', err => console.log('Redis Client Error', err));
    
    await client.connect();
    
    // 写入
    await client.set('foo', 'bar');
    ```
  
    
  

非关系型数据库不局限于特定的表结构，可以将数据直接存入，非常方便和灵活

但相对的其操作和查询数据的效率比SQL要低很多，同时因为NoSQL中不存在外键，所以记录中的一些公共数据无法被抽取，因此NoSQL往往存在数据容易



### 使用推荐

一般实际开发中

1. 使用SQL进行持久化化存储
2. 使用NoSQL做一些临时缓存，日志记录，爬取到的数据等非关键信息的临时存储



## 安装

我们一般以代码的方式像数据库发送SQL语句，因此实际操作数据的那一端被称之为数据库服务端

我们代码这一点被称之为 数据库的客户端

```shell
# 安装 mysql => 同时安装 数据库 「 服务端 」 和 命令行工具 muysql「 客户端 」
brew install mysql

# 查看版本 => 检查是否安装成功
mysql --version # 9.3.0

# 初次安装会提示进行安全加固
# 1. 默认存在无密码用户 root「 管理员账号 」 => 需要为其设置密码
# 2. 删除测试数据库 test
# 3. 选择是否允许root通过ip远程登录数据库 
#    => 一般都是禁止，实际通过ssh客户端远程登录服务器，在通过控制台进行登录 
#    => 关闭可以减低root密码被黑客破解的风险「 SSH比http要安全 」
mysql_secure_installation

# 启动服务 => 默认服务端口 3306
brew services start mysql

# 停止服务
brew services stop mysql

# 登录mysql
# 回车输入密码，进入mysql的 crud 环境
# 通过 exit; 退出 crud 环境
mysql -u <用户名，如root> -p
```



## 默认数据库

MySQL  默认存在四个内置数据库

```shell
mysql> SHOW DATABASES; # 查看所有数据库
+--------------------+
| Database           |  
+--------------------+
| information_schema | # 存储数据库元信息，记录了MySQL里所有数据库的表、列、字段和访问权限等信息
| mysql              | # 存用户、权限和日志等相关信息
| performance_schema | # 记录MySQL运行时的性能数据
| sys                | # 一个辅助性数据库 => 基于 performance_schema 和 information_schema 的数据
+--------------------+ #               => 把底层复杂的性能数据汇总、加工、格式化成更易读的表和视图
4 rows in set (0.014 sec)
```



## 基本语法规则

1. SQL可以换行编写，直到遇到 分号

   + 通过分号来标识一条SQL语句的结束 => 分号不可以省略
   + 最后一条SQL的分号可以省略 => 不推荐

2. 关键字不区分大小写，但推荐大写，以和用户自定义表名，数据库名进行区分

3. 用户自定义表名，数据库名等，区分大小写，一般推荐为小写

   + 不应该和 关键字同名 或 存在空格等非法字符

   + 如果和关键字同名 或 存在非法字符，需要使用反引号进行包裹

   + 所以始终通过反引号将用户自定义标识包裹起来是一个非常好的习惯

     

   + 可以通过一些前缀来对用户自定义标识进行更一部分区分 「 约定规则 」

   + 例如:

     + `t_<表名>`
     + `<数据库名>_db`



## 注释

1. 单行注释 => 注释标识后需有至少一个空格

   + `--` => SQL的通用注释

   + `#` => MySQL的扩展注释 => MySQL中支持，别的可能不支持

2. 多行注释

   + `/*  */`



## SQL分类

SQL语句可以分为如下几类：

| 分类 | 全称                         | 主要作用           | 常见语句                              |
| ---- | ---------------------------- | ------------------ | ------------------------------------- |
| DDL  | Data Definition Language     | 定义/修改结构      | CREATE, ALTER, DROP, TRUNCATE, RENAME |
| DQL  | Data Query Language          | 查询数据           | SELECT                                |
| DML  | Data Manipulation Language   | 操作数据（增删改） | INSERT, UPDATE, DELETE                |
| DCL  | Data Control Language        | 权限控制           | GRANT, REVOKE                         |
| TCL  | Transaction Control Language | 事务控制           | COMMIT, ROLLBACK, SAVEPOINT           |

> 事务是捆绑在一起的多条SQL语句，这些SQL语句是一个整体，要么全部成功，要么全部失败，不可能只成功一部分。
>
> 因为事务中的某条SQL执行失败，整个事务执行成功部分会被回滚 「 撤销操作 」，这个特征被称之为事务的 **原子性**



## GUI

通过命令或MySQL的crud环境操作SQL存在如下问题:

1. 代码没高亮，容易写错
2. 换行麻烦，操作不方便
3. 没有自动补全和错误提示
4. 查询结果显示不够直观
5. 操作的SQL无法被单独保存，方便日后复用

常见的 SQL GUI有

+ `Navicat` => 基本上支持所有的`SQL`、`NoSQL`、云数据库等
+ `SQLYog` => 仅支持 `MySQL`

 `VSCode` 等 `IDE` 也存在对应插件 可以直接IDE中以可视化方式操作 MySQL
